use super::Rem;

/// Enum that represents a short (0-3) bit pattern using
/// a 4-bit value, using all bits after the most-significant
/// 1 bit.
///
/// Example: `Bits::B01 == 5 == 0b101` => `01`
#[derive(Debug, Copy, Clone, PartialEq, Eq)]
#[repr(u8)]
pub enum Bits {
    B = 1,
    B0,
    B1,
    B00,
    B01,
    B10,
    B11,
    B000,
    B001,
    B010,
    B011,
    B100,
    B101,
    B110,
    B111,
}

impl Bits {
    pub fn from_u8_msb_to_lsb(input: u8) -> [Bits; 3] {
        MSB_TO_LSB[input as usize]
    }

    pub fn from_u8_lsb_to_msb(input: u8) -> [Bits; 3] {
        LSB_TO_MSB[input as usize]
    }

    pub fn off(state: u16, rem: Rem) -> Self {
        let (bit, mask) = match rem {
            Rem::R0 => (0b00000001, 0x0000),
            Rem::R1 => (0b00000010, 0x0001),
            Rem::R2 => (0b00000100, 0x0003),
        };
        unsafe { std::mem::transmute((state & mask) as u8 | bit) }
    }

    pub fn push(&self, state: &mut u16, off: &mut u8) {
        use Bits::*;
        match self {
            B => {}
            B0 | B1 => {
                *state = (*state << 1) | ((*self as u8) & 0b00000001) as u16;
                *off += 1;
            }
            B00 | B01 | B10 | B11 => {
                *state = (*state << 2) | ((*self as u8) & 0b00000011) as u16;
                *off += 2;
            }
            B000 | B001 | B010 | B011 | B100 | B101 | B110 | B111 => {
                *state = (*state << 3) | ((*self as u8) & 0b00000111) as u16;
                *off += 3;
            }
        }
    }
}

#[rustfmt::skip]
const MSB_TO_LSB: [[Bits; 3]; 256] = {
    use Bits::*;
    [
        [B000, B000, B00], [B000, B000, B01], [B000, B000, B10], [B000, B000, B11],
        [B000, B001, B00], [B000, B001, B01], [B000, B001, B10], [B000, B001, B11],
        [B000, B010, B00], [B000, B010, B01], [B000, B010, B10], [B000, B010, B11],
        [B000, B011, B00], [B000, B011, B01], [B000, B011, B10], [B000, B011, B11],
        [B000, B100, B00], [B000, B100, B01], [B000, B100, B10], [B000, B100, B11],
        [B000, B101, B00], [B000, B101, B01], [B000, B101, B10], [B000, B101, B11],
        [B000, B110, B00], [B000, B110, B01], [B000, B110, B10], [B000, B110, B11],
        [B000, B111, B00], [B000, B111, B01], [B000, B111, B10], [B000, B111, B11],
        [B001, B000, B00], [B001, B000, B01], [B001, B000, B10], [B001, B000, B11],
        [B001, B001, B00], [B001, B001, B01], [B001, B001, B10], [B001, B001, B11],
        [B001, B010, B00], [B001, B010, B01], [B001, B010, B10], [B001, B010, B11],
        [B001, B011, B00], [B001, B011, B01], [B001, B011, B10], [B001, B011, B11],
        [B001, B100, B00], [B001, B100, B01], [B001, B100, B10], [B001, B100, B11],
        [B001, B101, B00], [B001, B101, B01], [B001, B101, B10], [B001, B101, B11],
        [B001, B110, B00], [B001, B110, B01], [B001, B110, B10], [B001, B110, B11],
        [B001, B111, B00], [B001, B111, B01], [B001, B111, B10], [B001, B111, B11],
        [B010, B000, B00], [B010, B000, B01], [B010, B000, B10], [B010, B000, B11],
        [B010, B001, B00], [B010, B001, B01], [B010, B001, B10], [B010, B001, B11],
        [B010, B010, B00], [B010, B010, B01], [B010, B010, B10], [B010, B010, B11],
        [B010, B011, B00], [B010, B011, B01], [B010, B011, B10], [B010, B011, B11],
        [B010, B100, B00], [B010, B100, B01], [B010, B100, B10], [B010, B100, B11],
        [B010, B101, B00], [B010, B101, B01], [B010, B101, B10], [B010, B101, B11],
        [B010, B110, B00], [B010, B110, B01], [B010, B110, B10], [B010, B110, B11],
        [B010, B111, B00], [B010, B111, B01], [B010, B111, B10], [B010, B111, B11],
        [B011, B000, B00], [B011, B000, B01], [B011, B000, B10], [B011, B000, B11],
        [B011, B001, B00], [B011, B001, B01], [B011, B001, B10], [B011, B001, B11],
        [B011, B010, B00], [B011, B010, B01], [B011, B010, B10], [B011, B010, B11],
        [B011, B011, B00], [B011, B011, B01], [B011, B011, B10], [B011, B011, B11],
        [B011, B100, B00], [B011, B100, B01], [B011, B100, B10], [B011, B100, B11],
        [B011, B101, B00], [B011, B101, B01], [B011, B101, B10], [B011, B101, B11],
        [B011, B110, B00], [B011, B110, B01], [B011, B110, B10], [B011, B110, B11],
        [B011, B111, B00], [B011, B111, B01], [B011, B111, B10], [B011, B111, B11],
        [B100, B000, B00], [B100, B000, B01], [B100, B000, B10], [B100, B000, B11],
        [B100, B001, B00], [B100, B001, B01], [B100, B001, B10], [B100, B001, B11],
        [B100, B010, B00], [B100, B010, B01], [B100, B010, B10], [B100, B010, B11],
        [B100, B011, B00], [B100, B011, B01], [B100, B011, B10], [B100, B011, B11],
        [B100, B100, B00], [B100, B100, B01], [B100, B100, B10], [B100, B100, B11],
        [B100, B101, B00], [B100, B101, B01], [B100, B101, B10], [B100, B101, B11],
        [B100, B110, B00], [B100, B110, B01], [B100, B110, B10], [B100, B110, B11],
        [B100, B111, B00], [B100, B111, B01], [B100, B111, B10], [B100, B111, B11],
        [B101, B000, B00], [B101, B000, B01], [B101, B000, B10], [B101, B000, B11],
        [B101, B001, B00], [B101, B001, B01], [B101, B001, B10], [B101, B001, B11],
        [B101, B010, B00], [B101, B010, B01], [B101, B010, B10], [B101, B010, B11],
        [B101, B011, B00], [B101, B011, B01], [B101, B011, B10], [B101, B011, B11],
        [B101, B100, B00], [B101, B100, B01], [B101, B100, B10], [B101, B100, B11],
        [B101, B101, B00], [B101, B101, B01], [B101, B101, B10], [B101, B101, B11],
        [B101, B110, B00], [B101, B110, B01], [B101, B110, B10], [B101, B110, B11],
        [B101, B111, B00], [B101, B111, B01], [B101, B111, B10], [B101, B111, B11],
        [B110, B000, B00], [B110, B000, B01], [B110, B000, B10], [B110, B000, B11],
        [B110, B001, B00], [B110, B001, B01], [B110, B001, B10], [B110, B001, B11],
        [B110, B010, B00], [B110, B010, B01], [B110, B010, B10], [B110, B010, B11],
        [B110, B011, B00], [B110, B011, B01], [B110, B011, B10], [B110, B011, B11],
        [B110, B100, B00], [B110, B100, B01], [B110, B100, B10], [B110, B100, B11],
        [B110, B101, B00], [B110, B101, B01], [B110, B101, B10], [B110, B101, B11],
        [B110, B110, B00], [B110, B110, B01], [B110, B110, B10], [B110, B110, B11],
        [B110, B111, B00], [B110, B111, B01], [B110, B111, B10], [B110, B111, B11],
        [B111, B000, B00], [B111, B000, B01], [B111, B000, B10], [B111, B000, B11],
        [B111, B001, B00], [B111, B001, B01], [B111, B001, B10], [B111, B001, B11],
        [B111, B010, B00], [B111, B010, B01], [B111, B010, B10], [B111, B010, B11],
        [B111, B011, B00], [B111, B011, B01], [B111, B011, B10], [B111, B011, B11],
        [B111, B100, B00], [B111, B100, B01], [B111, B100, B10], [B111, B100, B11],
        [B111, B101, B00], [B111, B101, B01], [B111, B101, B10], [B111, B101, B11],
        [B111, B110, B00], [B111, B110, B01], [B111, B110, B10], [B111, B110, B11],
        [B111, B111, B00], [B111, B111, B01], [B111, B111, B10], [B111, B111, B11],
    ]
};

#[rustfmt::skip]
const LSB_TO_MSB: [[Bits; 3]; 256] = {
    use Bits::*;
    [
        [B000, B000, B00],[B100, B000, B00],[B010, B000, B00],[B110, B000, B00],
        [B001, B000, B00],[B101, B000, B00],[B011, B000, B00],[B111, B000, B00],
        [B000, B100, B00],[B100, B100, B00],[B010, B100, B00],[B110, B100, B00],
        [B001, B100, B00],[B101, B100, B00],[B011, B100, B00],[B111, B100, B00],
        [B000, B010, B00],[B100, B010, B00],[B010, B010, B00],[B110, B010, B00],
        [B001, B010, B00],[B101, B010, B00],[B011, B010, B00],[B111, B010, B00],
        [B000, B110, B00],[B100, B110, B00],[B010, B110, B00],[B110, B110, B00],
        [B001, B110, B00],[B101, B110, B00],[B011, B110, B00],[B111, B110, B00],
        [B000, B001, B00],[B100, B001, B00],[B010, B001, B00],[B110, B001, B00],
        [B001, B001, B00],[B101, B001, B00],[B011, B001, B00],[B111, B001, B00],
        [B000, B101, B00],[B100, B101, B00],[B010, B101, B00],[B110, B101, B00],
        [B001, B101, B00],[B101, B101, B00],[B011, B101, B00],[B111, B101, B00],
        [B000, B011, B00],[B100, B011, B00],[B010, B011, B00],[B110, B011, B00],
        [B001, B011, B00],[B101, B011, B00],[B011, B011, B00],[B111, B011, B00],
        [B000, B111, B00],[B100, B111, B00],[B010, B111, B00],[B110, B111, B00],
        [B001, B111, B00],[B101, B111, B00],[B011, B111, B00],[B111, B111, B00],
        [B000, B000, B10],[B100, B000, B10],[B010, B000, B10],[B110, B000, B10],
        [B001, B000, B10],[B101, B000, B10],[B011, B000, B10],[B111, B000, B10],
        [B000, B100, B10],[B100, B100, B10],[B010, B100, B10],[B110, B100, B10],
        [B001, B100, B10],[B101, B100, B10],[B011, B100, B10],[B111, B100, B10],
        [B000, B010, B10],[B100, B010, B10],[B010, B010, B10],[B110, B010, B10],
        [B001, B010, B10],[B101, B010, B10],[B011, B010, B10],[B111, B010, B10],
        [B000, B110, B10],[B100, B110, B10],[B010, B110, B10],[B110, B110, B10],
        [B001, B110, B10],[B101, B110, B10],[B011, B110, B10],[B111, B110, B10],
        [B000, B001, B10],[B100, B001, B10],[B010, B001, B10],[B110, B001, B10],
        [B001, B001, B10],[B101, B001, B10],[B011, B001, B10],[B111, B001, B10],
        [B000, B101, B10],[B100, B101, B10],[B010, B101, B10],[B110, B101, B10],
        [B001, B101, B10],[B101, B101, B10],[B011, B101, B10],[B111, B101, B10],
        [B000, B011, B10],[B100, B011, B10],[B010, B011, B10],[B110, B011, B10],
        [B001, B011, B10],[B101, B011, B10],[B011, B011, B10],[B111, B011, B10],
        [B000, B111, B10],[B100, B111, B10],[B010, B111, B10],[B110, B111, B10],
        [B001, B111, B10],[B101, B111, B10],[B011, B111, B10],[B111, B111, B10],
        [B000, B000, B01],[B100, B000, B01],[B010, B000, B01],[B110, B000, B01],
        [B001, B000, B01],[B101, B000, B01],[B011, B000, B01],[B111, B000, B01],
        [B000, B100, B01],[B100, B100, B01],[B010, B100, B01],[B110, B100, B01],
        [B001, B100, B01],[B101, B100, B01],[B011, B100, B01],[B111, B100, B01],
        [B000, B010, B01],[B100, B010, B01],[B010, B010, B01],[B110, B010, B01],
        [B001, B010, B01],[B101, B010, B01],[B011, B010, B01],[B111, B010, B01],
        [B000, B110, B01],[B100, B110, B01],[B010, B110, B01],[B110, B110, B01],
        [B001, B110, B01],[B101, B110, B01],[B011, B110, B01],[B111, B110, B01],
        [B000, B001, B01],[B100, B001, B01],[B010, B001, B01],[B110, B001, B01],
        [B001, B001, B01],[B101, B001, B01],[B011, B001, B01],[B111, B001, B01],
        [B000, B101, B01],[B100, B101, B01],[B010, B101, B01],[B110, B101, B01],
        [B001, B101, B01],[B101, B101, B01],[B011, B101, B01],[B111, B101, B01],
        [B000, B011, B01],[B100, B011, B01],[B010, B011, B01],[B110, B011, B01],
        [B001, B011, B01],[B101, B011, B01],[B011, B011, B01],[B111, B011, B01],
        [B000, B111, B01],[B100, B111, B01],[B010, B111, B01],[B110, B111, B01],
        [B001, B111, B01],[B101, B111, B01],[B011, B111, B01],[B111, B111, B01],
        [B000, B000, B11],[B100, B000, B11],[B010, B000, B11],[B110, B000, B11],
        [B001, B000, B11],[B101, B000, B11],[B011, B000, B11],[B111, B000, B11],
        [B000, B100, B11],[B100, B100, B11],[B010, B100, B11],[B110, B100, B11],
        [B001, B100, B11],[B101, B100, B11],[B011, B100, B11],[B111, B100, B11],
        [B000, B010, B11],[B100, B010, B11],[B010, B010, B11],[B110, B010, B11],
        [B001, B010, B11],[B101, B010, B11],[B011, B010, B11],[B111, B010, B11],
        [B000, B110, B11],[B100, B110, B11],[B010, B110, B11],[B110, B110, B11],
        [B001, B110, B11],[B101, B110, B11],[B011, B110, B11],[B111, B110, B11],
        [B000, B001, B11],[B100, B001, B11],[B010, B001, B11],[B110, B001, B11],
        [B001, B001, B11],[B101, B001, B11],[B011, B001, B11],[B111, B001, B11],
        [B000, B101, B11],[B100, B101, B11],[B010, B101, B11],[B110, B101, B11],
        [B001, B101, B11],[B101, B101, B11],[B011, B101, B11],[B111, B101, B11],
        [B000, B011, B11],[B100, B011, B11],[B010, B011, B11],[B110, B011, B11],
        [B001, B011, B11],[B101, B011, B11],[B011, B011, B11],[B111, B011, B11],
        [B000, B111, B11],[B100, B111, B11],[B010, B111, B11],[B110, B111, B11],
        [B001, B111, B11],[B101, B111, B11],[B011, B111, B11],[B111, B111, B11],
    ]
};
